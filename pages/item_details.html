<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="../static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../static/favicon/favicon-16x16.png">
    <title>Item Viewer - The Galleon</title>
    <meta property="og:title" content="Item Viewer - The Galleon">
    <meta name="twitter:title" content="Item Viewer - The Galleon">
    <meta name="description" content="(THIS WEBSITE IS JUST A TEST PROJECT AND NOT ENDORSED NOR APPROVED BY THE GALLEON STAFF) The Value List is an unofficial project that is produced by The Galleon, it contains the values of every valuable in Arcane Odyssey!">
    <meta property="og:description" content="(THIS WEBSITE IS JUST A TEST PROJECT AND NOT ENDORSED NOR APPROVED BY THE GALLEON STAFF) The Value List is an unofficial project that is produced by The Galleon, it contains the values of every valuable in Arcane Odyssey!">
    <meta name="twitter:description" content="(THIS WEBSITE IS JUST A TEST PROJECT AND NOT ENDORSED NOR APPROVED BY THE GALLEON STAFF) The Value List is an unofficial project that is produced by The Galleon, it contains the values of every valuable in Arcane Odyssey!">
    <meta property="og:image"  content="https://espinafr.github.io/The-Galleon/static/images/banner.png">
    <meta name="twitter:image" content="https://espinafr.github.io/The-Galleon/static/images/banner.png">
    <script src="../main.js"></script>
    <link rel="stylesheet" href="../main.css">
</head>
<body class="font-serif flex justify-center items-center flex-col gap-5 w-full p-5 bg-blue-300">
    <div class="paper self-start p-4!">
        <div class="flex items-center">
            <div>
                <h2 class="text-3xl text-center text-orange-400 text-shadow-md text-shadow-orange-900">The Galleon</h2>
                <h3 class="text-lg text-center text-orange-500 text-shadow-md text-shadow-orange-300">Item Info</h3>
            </div>
            <p class="mx-5 text-3xl text-orange-400">-</p>
            <p class="text-2xl hover:underline text-slate-800"><a href="../index.html">Go Back</a></p>
        </div>
        <div class="paper grid md:grid-cols-3 lg:grid-cols-7 gap-4 items-center">
            <p class="text-md text-center text-pink-500 text-shadow-md text-shadow-pink-300"><a href="item_pages/seasonals.html">Seasonals</a></p>
            <p class="text-md text-center text-blue-500 text-shadow-md text-shadow-blue-300"><a href="item_pages/rare_items.html">Rare Items</a></p>
            <p class="text-md text-center text-purple-500 text-shadow-md text-shadow-purple-300"><a href="item_pages/scrolls.html">Scrolls</a></p>
            <p class="text-md text-center text-yellow-500 text-shadow-md text-shadow-yellow-300"><a href="item_pages/npc_drops.html">NPC Drops</a></p>
            <p class="text-md text-center text-orange-500 text-shadow-md text-shadow-orange-300"><a href="item_pages/ingredients.html">Ingredients</a></p>
            <p class="text-md text-center text-red-500 text-shadow-md text-shadow-red-300"><a href="item_pages/modified_items.html">Modified Items</a></p>
            <p class="text-md text-center text-green-500 text-shadow-md text-shadow-green-300"><a href="item_pages/miscellaneous.html">Miscellaneous</a></p>
        </div>
    </div>
    <div class="paper flex-1 flex flex-col md:flex-row items-center lg:justify-center md:w-4/5 gap-6" id="itemContainer">
        <div class="text-center">
            <div class="w-60 h-60 m-5">
                <img id="image" src="" alt="Loading image" class="w-full h-full">
            </div>
            <h2 class="text-2xl text-orange-300 font-bold" id="name">Loading</h2>
        </div>
        <div class="text-lg flex flex-col">
            <div class="flex flex-col lg:grid lg:grid-cols-2 mb-5 gap-5">
                <div>
                    <p class="text-orange-300 text-xl font-bold">Description</p>
                    <p id="description">Loading, please wait...</p>
                </div>
                <div>
                    <p class="text-orange-300 text-xl font-bold">Value Editor's Notes</p>
                    <p id="editornotes">Loading, please wait...</p>
                </div>
            </div>
            <div class="text-center flex justify-center gap-4">
                <div>
                    <p class="text-green-500">Value:</p>
                    <p id="value"></p>
                </div>
                <div>
                    <p class="text-green-500">Death Crowns:</p>
                    <p id="deathcrowns"></p>
                </div>
                <div>
                    <p class="text-green-500">Demand:</p>
                    <p id="demand"></p>
                </div>
                <div>
                    <p class="text-green-500">Value Changes:</p>
                    <p id="value_changes"></p>
                </div>
            </div>
        </div>
        <div class="absolute! text-right right-3 bottom-3 cursor-pointer" onclick="copyLink()"><p class="text-3xl hover:text-orange-400 transition-250 transition-colors">â†’</p></div>
    </div>
    <svg class="pointer-events-none hidden">
        <filter id="wavy">
            <feTurbulence x="0" y="0" baseFrequency="0.02" numOctaves="3" seed="7" />
            <feDisplacementMap in="SourceGraphic" scale="10" />
        </filter>
    </svg>
</body>
<script>
    function copyLink() {
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(window.location.href)
                .then(() => alert("Link copied!"))
                .catch(err => alert("Failed to copy: " + err));
        } else {
            alert("Your browser does not support clipboard operations in this context.");
        }
    }

    function formatValueChange(oldValue, todayValue) {
        if (oldValue === "N/A") {
            return "N/A";
        } else {
            const change = todayValue - oldValue;
            const sign = change > 0 ? "+" : "";
            return `<span class="text-${change > 0 ? "green" : "red"}-500">${sign}${change.toLocaleString()} (${sign}${((change / oldValue) * 100).toFixed(2)}%)`;
        }
    }

    function renderDetails(item, death_crown_base_value) {
        const imageContainer = document.getElementById("image");
        imageContainer.src = item.image;
        imageContainer.alt = `${item.name}'s image`;
        document.getElementById("name").innerText = item.name;
        document.getElementById("description").innerText = item.description;
        document.getElementById("editornotes").innerText = item.notes;

        document.getElementById("value").innerText = item.value.toLocaleString();
        document.getElementById("deathcrowns").innerText = parseFloat((item.value/death_crown_base_value).toFixed(2)).toLocaleString();
        document.getElementById("demand").innerHTML = addDemand(item.demand);
        document.getElementById("value_changes").innerHTML = formatValueChange(item.oldvalue, item.value);
    }

    function isIdValid(str) {
        if (str === '') return false;
        if (!/^\d+$/.test(str)) return false;
        const num = Number(str);
        return num >= 2? true : false;
    }

    document.addEventListener('DOMContentLoaded', async function() {
        const item_type = new URLSearchParams(window.location.search).get('type');
        const id = new URLSearchParams(window.location.search).get('id');

        if (isIdValid(id) === false || !(item_type in ITEMS_GID)) {
            document.getElementById("itemContainer").innerHTML = `<p class="text-2xl text-red-500">Invalid item type or id provided.</p>`;
            return;
        } else {
            const items = await loadSheet(`${ITEMS_GID[item_type]}&range=${id}:${id}`, mapItemRow);
            const death_crown_base_value = await getConfig('death_crown_base_value');
            renderDetails(items[0], death_crown_base_value);
        }
    });
</script>
</html>